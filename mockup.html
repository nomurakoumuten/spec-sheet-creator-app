<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【デモ】住宅仕様決定アプリ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif; }
        .modal { display: none; }
        .modal.is-open { display: flex; }
        .product-card.highlighted { border-color: #3b82f6; border-width: 2px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- モックアップ強調メッセージ -->
    <div class="bg-yellow-300 text-yellow-800 text-center p-2 fixed top-0 w-full z-50 font-bold shadow">
        これは動作を体験するためのモックアップ（見本）です。実際のデータは保存されません。
    </div>

    <!-- ===== スタート画面 ===== -->
    <div id="start-screen" class="container mx-auto max-w-2xl p-8 pt-20">
        <div class="bg-white p-8 rounded-lg shadow-lg text-center">
            <h1 class="text-3xl font-bold text-gray-800">住宅仕様決定アプリ</h1>
            <p class="text-gray-600 mt-2">お客様との仕様打ち合わせを、スムーズかつ正確に。</p>
            <div class="mt-8 border-t pt-6">
                <h2 class="text-xl font-semibold">案件を開始</h2>
                <div class="mt-4 flex flex-col gap-4">
                    <input type="text" id="start-customer-name" placeholder="顧客名を入力" class="w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500">
                    <button id="start-new-project-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-md hover:bg-blue-700 transition">新規案件 開始</button>
                    <button id="load-existing-project-btn" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-md hover:bg-green-700 transition">既存案件を読込</button>
                </div>
            </div>
             <div class="mt-6">
                <a href="#" id="show-manual-link" class="text-sm text-blue-600 hover:underline">操作マニュアルを見る</a>
            </div>
        </div>
    </div>

    <!-- ===== メインアプリ画面 (初期状態は非表示) ===== -->
    <div id="app-screen" class="hidden container mx-auto p-4 max-w-7xl pt-16">
        <header class="bg-white p-4 rounded-lg shadow-md mb-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-700">住宅仕様決定アプリ</h1>
                <a href="#" id="show-manual-link-main" class="text-sm text-blue-600 hover:underline">操作マニュアル</a>
            </div>
            <div id="project-info" class="text-sm text-gray-600 mt-2 font-semibold"></div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div class="lg:col-span-1 bg-white p-4 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-3 border-b pb-2">1. 項目選択</h2>
                <div id="category-list" class="space-y-2"></div>
            </div>
            <div class="lg:col-span-2 bg-white p-4 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-3 border-b pb-2">2. 仕様一覧</h2>
                <div id="selected-items-list" class="space-y-3"></div>
                <button id="add-custom-item-btn" class="mt-4 text-sm bg-green-500 text-white font-bold py-1 px-3 rounded-md hover:bg-green-600 transition">+ 特注品を追加</button>
                <div class="mt-6 text-right">
                    <p class="text-2xl font-bold">総合計: <span id="total-amount" class="text-red-600">¥0</span></p>
                </div>
                <div class="mt-6 pt-4 border-t flex justify-end gap-4 flex-wrap">
                    <button class="action-btn bg-purple-600 text-white font-bold py-2 px-6 rounded-md hover:bg-purple-700 transition">履歴確認</button>
                    <button class="action-btn bg-gray-500 text-white font-bold py-2 px-6 rounded-md hover:bg-gray-600 transition">一時保存</button>
                    <button class="action-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-md hover:bg-yellow-600 transition">承認サイン</button>
                    <button class="action-btn bg-red-600 text-white font-bold py-2 px-6 rounded-md hover:bg-red-700 transition">プランシート作成 (PDF)</button>
                </div>
            </div>
        </main>
    </div>

    <!-- ===== モーダルウィンドウ群 ===== -->
    <!-- 案件読込モーダル -->
    <div id="load-project-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-40 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[80vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center"><h3 class="text-xl font-bold">既存案件の読込</h3><button class="close-modal-btn text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div>
            <div class="p-4"><input type="text" placeholder="顧客名で検索..." class="w-full p-2 border rounded-md mb-4"></div>
            <div class="p-4 pt-0 overflow-y-auto">
                <div class="p-3 border-b cursor-pointer hover:bg-gray-100 project-item" data-name="田中様邸">田中様邸</div>
                <div class="p-3 border-b cursor-pointer hover:bg-gray-100 project-item" data-name="鈴木様邸">鈴木様邸</div>
            </div>
        </div>
    </div>

    <!-- 商品選択モーダル -->
    <div id="product-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-40 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl flex flex-col">
            <div class="p-4 border-b flex justify-between items-center flex-shrink-0"><h3 id="modal-category-title" class="text-xl font-bold"></h3><button class="close-modal-btn text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div>
            <div class="p-6 overflow-y-auto" style="max-height: calc(100vh - 180px);">
                <div class="bg-gray-100 p-4 rounded-lg mb-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div><label class="block text-sm font-medium text-gray-700">メーカー名</label><select id="filter-manufacturer" class="filter-select mt-1 block w-full p-2 border rounded-md bg-white"></select></div>
                    <div><label class="block text-sm font-medium text-gray-700">品名</label><select id="filter-name" class="filter-select mt-1 block w-full p-2 border rounded-md bg-white"></select></div>
                </div>
                <h4 class="text-lg font-semibold mb-3">商品リスト</h4>
                <div id="modal-product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                <div id="modal-example-gallery" class="mt-8"></div>
            </div>
            <div class="p-4 border-t flex justify-between items-center flex-shrink-0">
                <button id="deselect-product-btn" class="bg-gray-500 text-white font-bold py-2 px-6 rounded-md hover:bg-gray-600 transition" disabled>選択解除</button>
                <div>
                    <button class="close-modal-btn bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-md hover:bg-gray-400">キャンセル</button>
                    <button id="select-product-btn" class="ml-4 bg-blue-600 text-white font-bold py-2 px-6 rounded-md hover:bg-blue-700 transition" disabled>この商品を選択</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- マニュアルモーダル -->
    <div id="manual-modal" class="modal fixed inset-0 bg-black bg-opacity-60 z-50 items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center"><h2 class="text-2xl font-bold">操作マニュアル</h2><button class="close-modal-btn text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div>
            <div class="p-8 overflow-y-auto">
                <div class="space-y-12">
                    <section><h2 class="text-2xl font-semibold border-b pb-3 mb-4 text-blue-700">1. 案件の開始と読込</h2><div class="space-y-4"><div><h3 class="text-lg font-semibold">新規案件を開始する場合</h3><ol class="list-decimal list-inside mt-2 space-y-1 text-gray-700"><li>「顧客名を入力」欄にお客様の名前を入力します。</li><li>「新規案件 開始」ボタンをクリックします。</li><li>確認ダイアログが表示されたら「OK」を押します。案件が作成され、編集可能になります。</li></ol></div><div><h3 class="text-lg font-semibold">既存の案件を読み込む場合</h3><ol class="list-decimal list-inside mt-2 space-y-1 text-gray-700"><li>「案件読込」ボタンをクリックします。</li><li>案件リストが表示されるので、読み込みたい案件をクリックします。</li><li>過去に保存した仕様が画面に表示されます。</li></ol></div></div></section>
                    <section><h2 class="text-2xl font-semibold border-b pb-3 mb-4 text-green-700">2. 商品の選択</h2><div class="space-y-4 text-gray-700"><ol class="list-decimal list-inside space-y-2"><li>左側の「1. 項目選択」から、仕様を決定したいカテゴリ（例：キッチン、バス）のボタンをクリックします。</li><li>商品選択画面が表示されます。メーカー名などで商品を絞り込むことも可能です。</li><li>追加したい商品をクリックしてハイライト（青い枠線）させます。</li><li>商品の施工事例が下部に表示されるので、参考にしてください。</li><li>画面右下の「この商品を選択」ボタンをクリックします。</li><li>確認ダイアログが表示されたら「OK」を押すと、右側の「2. 仕様一覧」に商品が追加されます。</li></ol></div></section>
                    <section><h2 class="text-2xl font-semibold border-b pb-3 mb-4 text-purple-700">3. 仕様の編集と保存</h2><div class="space-y-4 text-gray-700"><ol class="list-decimal list-inside space-y-2"><li>「仕様一覧」に追加された各商品について、「数量」や「使用場所・メモ」を自由に変更できます。</li><li>「一時保存」ボタンを押すと、現在の仕様がスプレッドシートに保存されます。こまめな保存を推奨します。</li><li>「履歴確認」ボタンから、過去に保存した時点の仕様を確認したり、その状態に戻したりすることができます。</li></ol></div></section>
                    <section><h2 class="text-2xl font-semibold border-b pb-3 mb-4 text-red-700">4. 承認とPDF出力</h2><div class="space-y-4 text-gray-700"><ol class="list-decimal list-inside space-y-2"><li>すべての仕様が確定したら、「承認サイン」ボタンを押してお客様からサインをいただきます。</li><li>「プランシート作成 (PDF)」ボタンを押すと、署名付きの仕様書がPDFとして生成されます。</li><li>生成されたPDFは、案件ごとのGoogle Driveフォルダに自動で保存されます。</li></ol></div></section>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== Mock Data =====
        const mockData = {
            products: {
                "キッチン": [
                    { id: 'k1', manufacturer: 'タカラスタンダード', name: 'オフェリア', price: 473937, imageUrl: 'https://placehold.co/300x200/e0f2fe/0891b2?text=Kitchen+A' },
                    { id: 'k2', manufacturer: 'クリナップ', name: 'ステディア', price: 429598, imageUrl: 'https://placehold.co/300x200/dcfce7/16a34a?text=Kitchen+B' },
                    { id: 'k3', manufacturer: 'クリナップ', name: 'クリナップ t p', price: 561334, imageUrl: 'https://placehold.co/300x200/f3e8ff/7e22ce?text=Kitchen+C' }
                ],
                "バス": [
                    { id: 'b1', manufacturer: 'TOTO', name: 'サザナ', price: 650000, imageUrl: 'https://placehold.co/300x200/fef2f2/b91c1c?text=Bath+A' },
                    { id: 'b2', manufacturer: 'LIXIL', name: 'リデア', price: 720000, imageUrl: 'https://placehold.co/300x200/fff7ed/ea580c?text=Bath+B' }
                ],
                "トイレ": [
                    { id: 't1', manufacturer: 'TOTO', name: 'ネオレスト', price: 250000, imageUrl: 'https://placehold.co/300x200/eff6ff/1d4ed8?text=Toilet+A' }
                ]
            },
            examples: {
                'k2': [{ imageUrl: 'https://placehold.co/300x200/dcfce7/16a34a?text=Example+1', description: 'ステディアを使用したモダンなキッチン事例です。' }, { imageUrl: 'https://placehold.co/300x200/dcfce7/16a34a?text=Example+2', description: '白を基調とした清潔感のある空間。' }],
                'b1': [{ imageUrl: 'https://placehold.co/300x200/fef2f2/b91c1c?text=Example+3', description: 'サザナで実現する癒やしのバスタイム。' }]
            }
        };

        // ===== App State =====
        const state = {
            customerName: '',
            selectedItems: [],
            currentModalCategory: '',
            highlightedProductId: null,
            modalFilters: { manufacturer: '', name: '' }
        };

        // ===== DOM Elements =====
        const DOMElements = {
            startScreen: document.getElementById('start-screen'),
            appScreen: document.getElementById('app-screen'),
            startCustomerName: document.getElementById('start-customer-name'),
            startNewProjectBtn: document.getElementById('start-new-project-btn'),
            loadExistingProjectBtn: document.getElementById('load-existing-project-btn'),
            projectInfo: document.getElementById('project-info'),
            categoryList: document.getElementById('category-list'),
            selectedItemsList: document.getElementById('selected-items-list'),
            totalAmount: document.getElementById('total-amount'),
            loadProjectModal: document.getElementById('load-project-modal'),
            productModal: document.getElementById('product-modal'),
            modalCategoryTitle: document.getElementById('modal-category-title'),
            modalProductList: document.getElementById('modal-product-list'),
            modalExampleGallery: document.getElementById('modal-example-gallery'),
            filterManufacturer: document.getElementById('filter-manufacturer'),
            filterName: document.getElementById('filter-name'),
            deselectProductBtn: document.getElementById('deselect-product-btn'),
            selectProductBtn: document.getElementById('select-product-btn'),
            manualModal: document.getElementById('manual-modal'),
        };

        // ===== Event Listeners =====
        function init() {
            // Screen Transitions
            DOMElements.startNewProjectBtn.addEventListener('click', startNewProject);
            DOMElements.loadExistingProjectBtn.addEventListener('click', () => DOMElements.loadProjectModal.classList.add('is-open'));
            
            // Modals
            document.querySelectorAll('.close-modal-btn').forEach(btn => btn.addEventListener('click', (e) => e.target.closest('.modal').classList.remove('is-open')));
            document.querySelectorAll('.project-item').forEach(item => item.addEventListener('click', loadProject));
            document.querySelectorAll('.action-btn').forEach(btn => btn.addEventListener('click', (e) => alert(`（モック）「${e.target.textContent}」がクリックされました。`)));
            document.getElementById('add-custom-item-btn').addEventListener('click', () => alert('（モック）特注品追加画面が開きます。'));
            document.getElementById('show-manual-link').addEventListener('click', () => DOMElements.manualModal.classList.add('is-open'));
            document.getElementById('show-manual-link-main').addEventListener('click', () => DOMElements.manualModal.classList.add('is-open'));

            // Product Modal
            DOMElements.deselectProductBtn.addEventListener('click', () => highlightProduct(null));
            DOMElements.selectProductBtn.addEventListener('click', selectProductFromModal);
            document.querySelectorAll('.filter-select').forEach(sel => sel.addEventListener('change', applyProductFilter));
        }

        // ===== Functions =====
        function startNewProject() {
            const name = DOMElements.startCustomerName.value.trim();
            if (!name) {
                alert('顧客名を入力してください。');
                return;
            }
            state.customerName = name;
            state.selectedItems = [];
            DOMElements.startScreen.classList.add('hidden');
            DOMElements.appScreen.classList.remove('hidden');
            updateAppUI();
        }

        function loadProject(event) {
            state.customerName = event.target.dataset.name;
            state.selectedItems = [mockData.products['キッチン'][1]]; // Sample data
            DOMElements.loadProjectModal.classList.remove('is-open');
            DOMElements.startScreen.classList.add('hidden');
            DOMElements.appScreen.classList.remove('hidden');
            updateAppUI();
        }

        function updateAppUI() {
            DOMElements.projectInfo.textContent = `案件名: ${state.customerName} (編集中)`;
            renderCategories();
            renderSelectedItems();
        }

        function renderCategories() {
            DOMElements.categoryList.innerHTML = Object.keys(mockData.products).map(category => 
                `<button class="w-full text-left p-3 bg-gray-100 rounded-md hover:bg-blue-100 transition" onclick="openProductModal('${category}')">${category}</button>`
            ).join('');
        }

        function renderSelectedItems() {
            if (state.selectedItems.length === 0) {
                DOMElements.selectedItemsList.innerHTML = `<p class="text-gray-500 text-center py-4">商品は選択されていません。</p>`;
            } else {
                DOMElements.selectedItemsList.innerHTML = state.selectedItems.map((item, index) => `
                    <div class="bg-gray-50 p-3 rounded-lg border">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-bold text-lg">${item.name}</p>
                                <p class="text-sm text-gray-600">${item.category} | ${item.manufacturer}</p>
                            </div>
                            <button class="text-red-500 hover:text-red-700 font-bold" onclick="removeItem(${index})">削除</button>
                        </div>
                        <p class="text-lg font-semibold text-gray-800 text-right mt-2">¥${item.price.toLocaleString()}</p>
                    </div>
                `).join('');
            }
            updateTotalAmount();
        }
        
        function removeItem(index) {
            if (confirm(`「${state.selectedItems[index].name}」を削除しますか？`)) {
                state.selectedItems.splice(index, 1);
                renderSelectedItems();
            }
        }

        function updateTotalAmount() {
            const total = state.selectedItems.reduce((sum, item) => sum + item.price, 0);
            DOMElements.totalAmount.textContent = `¥${total.toLocaleString()}`;
        }

        function openProductModal(category) {
            state.currentModalCategory = category;
            state.highlightedProductId = null;
            DOMElements.modalCategoryTitle.textContent = `項目: ${category}`;
            populateFilterDropdowns();
            applyProductFilter();
            DOMElements.productModal.classList.add('is-open');
        }

        function populateFilterDropdowns() {
            const products = mockData.products[state.currentModalCategory] || [];
            const manufacturers = [...new Set(products.map(p => p.manufacturer))];
            const names = [...new Set(products.map(p => p.name))];
            
            DOMElements.filterManufacturer.innerHTML = '<option value="">すべて</option>' + manufacturers.map(m => `<option value="${m}">${m}</option>`).join('');
            DOMElements.filterName.innerHTML = '<option value="">すべて</option>' + names.map(n => `<option value="${n}">${n}</option>`).join('');
        }

        function applyProductFilter() {
            state.modalFilters.manufacturer = DOMElements.filterManufacturer.value;
            state.modalFilters.name = DOMElements.filterName.value;
            state.highlightedProductId = null;
            renderFilteredProducts();
        }

        function renderFilteredProducts() {
            const products = mockData.products[state.currentModalCategory] || [];
            const filtered = products.filter(p => 
                (!state.modalFilters.manufacturer || p.manufacturer === state.modalFilters.manufacturer) &&
                (!state.modalFilters.name || p.name === state.modalFilters.name)
            );

            DOMElements.modalProductList.innerHTML = filtered.map(product => `
                <div class="product-card rounded-lg p-3 cursor-pointer transition flex flex-col border ${state.highlightedProductId === product.id ? 'highlighted' : ''}" onclick="highlightProduct('${product.id}')">
                    <img src="${product.imageUrl}" class="w-full h-32 object-cover rounded-md mb-2">
                    <div class="flex-grow">
                        <h4 class="font-semibold">${product.name}</h4>
                        <p class="text-sm text-gray-600">${product.manufacturer}</p>
                    </div>
                    <p class="text-lg font-bold text-gray-800 mt-2">¥${product.price.toLocaleString()}</p>
                </div>
            `).join('');
            
            DOMElements.selectProductBtn.disabled = !state.highlightedProductId;
            DOMElements.deselectProductBtn.disabled = !state.highlightedProductId;
            renderExampleGallery();
        }

        function highlightProduct(productId) {
            state.highlightedProductId = state.highlightedProductId === productId ? null : productId;
            renderFilteredProducts();
        }

        function renderExampleGallery() {
            let examples = [];
            if (state.highlightedProductId) {
                examples = mockData.examples[state.highlightedProductId] || [];
            }
            
            let html = '<h4 class="text-lg font-semibold mb-3 border-t pt-6">施工事例ギャラリー</h4>';
            if (examples.length > 0) {
                html += `<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">${examples.map(ex => `
                    <div class="border rounded-lg p-3 bg-gray-50">
                        <img src="${ex.imageUrl}" class="w-full h-40 object-cover rounded-md mb-3">
                        <p class="text-sm text-gray-600 mt-1">${ex.description}</p>
                    </div>`).join('')}
                </div>`;
            } else {
                html += `<p class="text-gray-500">${state.highlightedProductId ? 'この商品の施工事例はありません。' : '商品を選択すると関連する施工事例が表示されます。'}</p>`;
            }
            DOMElements.modalExampleGallery.innerHTML = html;
        }

        function selectProductFromModal() {
            if (!state.highlightedProductId) return;
            const product = mockData.products[state.currentModalCategory].find(p => p.id === state.highlightedProductId);
            if (product && confirm(`「${product.name}」を仕様一覧に追加しますか？`)) {
                state.selectedItems.push(product);
                renderSelectedItems();
                DOMElements.productModal.classList.remove('is-open');
            }
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
